stages:
  prepare_data:
    cmd: python src/clara_ssot/scripts/prepare_data.py
    deps:
      - src/clara_ssot/scripts/prepare_data.py
      - data/raw
    params:
      - prepare.sample_size
      - prepare.seed
    outs:
      - data/prepared

  parse_documents:
    cmd: python src/clara_ssot/parsing/pdf_parser.py
    deps:
      - src/clara_ssot/parsing/pdf_parser.py
      - data/prepared
    outs:
      - data/parsed

  validate_terms:
    cmd: python src/clara_ssot/validation/term_validator.py
    deps:
      - src/clara_ssot/validation/term_validator.py
      - data/parsed
    params:
      - validation.rules
    outs:
      - data/validated

  normalize_data:
    cmd: python src/clara_ssot/normalization/term_mapper.py
    deps:
      - src/clara_ssot/normalization/term_mapper.py
      - data/validated
    outs:
      - data/normalized

  build_ssot:
    cmd: python src/clara_ssot/ssot/build_repository.py
    deps:
      - src/clara_ssot/ssot/doc_ssot_repository.py
      - src/clara_ssot/ssot/term_ssot_repository.py
      - data/normalized
    outs:
      - data/ssot
      - models/ssot_model.pkl

plots:
  - plots/metrics.csv:
      x: iteration
      y: accuracy
metrics:
  - metrics.json
